<section class="flex-1 flex flex-col bg-base-100 h-full overflow-hidden">
  @if (email()) {
  <pc-email-header
    [email]="email()!"
    (reply)="emitReply()"
    (replyAll)="emitReplyAll()"
    (forward)="emitForward()"
  ></pc-email-header>
  <main class="flex-1 h-full overflow-hidden p-4 flex flex-col gap-4">
    @if (!commentsExpanded() || (email() && store.isBodyExpanded())) {
    <!-- Body visible when comments are collapsed -->
    <pc-email-body
      class="flex-1 min-h-0 border-double border-b-2 border-gray-200 rounded-lg bg-white"
      [email]="email()!"
    >
    </pc-email-body>
    }

    <!-- Comments panel: either compact with status bar or expanded occupying remaining space -->
    @if (!store.isBodyExpanded()) {
    <div class="min-h-0 flex flex-col rounded-lg bg-white border border-gray-200 overflow-hidden">
      <!-- Status bar -->
      <button
        type="button"
        class="flex items-center justify-between px-3 py-2 text-left text-sm font-medium bg-gray-50 border-b border-gray-200 hover:bg-gray-100"
        (click)="toggleComments()"
        [attr.aria-expanded]="commentsExpanded()"
        aria-controls="comments-panel"
      >
        <span class="flex items-center gap-2">
          <span>Comments</span>
          <span
            class="inline-flex items-center justify-center rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700"
            >{{ commentCount() }}</span
          >
        </span>
        <span class="cursor-pointer ml-2 text-xs text-gray-500">@if (commentsExpanded()) { Hide } @else { Show }</span>
      </button>

      @if (commentsExpanded()) {
      <!-- Expanded comments fill available space -->
      <div id="comments-panel" class="flex-1 min-h-0 overflow-auto email-scrollbar">
        <pc-email-comments [email]="email()"> </pc-email-comments>
      </div>
      }
    </div>
    }
  </main>

  } @else if (isLoading()) {
  <div class="min-h-screen flex items-center justify-center">
    <span class="loading loading-bars"></span>
  </div>
  } @else if (showNoEmailMsg()){
  <div class="flex flex-1 flex-col items-center justify-center gap-3 text-gray-400 uppercase tracking-widest">
    <img class="max-w-64" src="assets/waiting.svg" />
    <span>No emails here!</span>
  </div>
  }
</section>
