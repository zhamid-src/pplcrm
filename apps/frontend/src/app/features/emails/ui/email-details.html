<section class="flex-1 flex flex-col bg-white h-full">
  @if (email) {
  <header class="border-b border-base-200 p-4">
    <!-- Row 1: Subject + labels (left), date + quick actions (right) -->
    <div class="flex items-start gap-3">
      <div class="min-w-0 flex-1">
        <div class="flex items-center gap-2 min-w-0">
          <h1 class="text-2xl font-semibold truncate">{{ email.subject }}</h1>

          <!-- Assigned to -->
          <div class="dropdown">
            <div tabindex="0" class="badge badge-info badge-outline cursor-pointer">
              {{ getUserName(email.assigned_to) }}
            </div>
            <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-44 p-2 shadow">
              @for (user of users(); track user.id) {
              <li><a (click)="assign(user.id)">{{ user.first_name }}</a></li>
              }
              @if (email.assigned_to) {
              <li><a (click)="assign(null)">Unassign</a></li>
              }
            </ul>
          </div>
        </div>
      </div>

      <div class="flex items-center gap-1 text-sm text-base-content/70">
        <span class="whitespace-nowrap pr-2"> {{ email.updated_at | date:'EEE, MMM d, h:mm a' }} </span>

        <!-- Quick actions -->
        <button class="btn btn-ghost btn-circle btn-sm" aria-label="Star">
          <!-- star icon -->
          <svg viewBox="0 0 24 24" class="h-5 w-5">
            <path
              fill="currentColor"
              d="m12 17.27 5.18 3.05-1.64-5.81 4.46-3.86-5.86-.5L12 4l-2.14 6.15-5.86.5 4.46 3.86-1.64 5.81z"
            />
          </svg>
        </button>
        <button class="btn btn-ghost btn-circle btn-sm" aria-label="Reply">
          <!-- reply icon -->
          <svg viewBox="0 0 24 24" class="h-5 w-5">
            <path fill="currentColor" d="M10 9V5l-7 7 7 7v-4.1c6 0 9.5 1.9 11 6.1-.5-5-4-10-11-10z" />
          </svg>
        </button>

        <div class="dropdown dropdown-end">
          <button class="btn btn-ghost btn-circle btn-sm" aria-label="More">
            <svg viewBox="0 0 24 24" class="h-5 w-5">
              <path
                fill="currentColor"
                d="M12 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"
              />
            </svg>
          </button>
          <ul class="menu dropdown-content bg-base-100 rounded-box z-[1] w-44 p-2 shadow">
            <li><a>Print</a></li>
            <li><a>Open in new</a></li>
            <li><a>Mark as unread</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Row 2: Sender line -->
    <div class="mt-3 flex items-center gap-3">
      <!-- Avatar -->
      <div class="avatar">
        <div class="w-10 rounded-full bg-base-200">
          <span class="flex h-full w-full items-center justify-center font-medium">
            {{ (email.from_name || email.from_email)![0] | uppercase }}
          </span>
        </div>
      </div>

      <div class="min-w-0 flex-1">
        <div class="flex items-baseline gap-2 min-w-0">
          <span class="font-semibold truncate"> {{ email.from_name || email.from_email }} </span>
          <span class="text-xs text-base-content/60 truncate"> &lt;{{ email.from_email }}&gt; </span>
        </div>

        <!-- To ... dropdown like Gmail -->
        <div class="text-xs text-base-content/60">
          to
          <div class="dropdown inline-block">
            <label tabindex="0" class="btn btn-link btn-xs no-underline align-baseline">
              {{ email.to_email }}
              <svg class="ml-1 h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                <path
                  d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"
                />
              </svg>
            </label>
            <ul tabindex="0" class="menu menu-sm dropdown-content z-[1] mt-1 w-72 rounded-box bg-base-100 p-2 shadow">
              <li class="menu-title text-xs">Recipients</li>
              <li><a class="truncate">{{ email.to_email }}</a></li>
              <!-- If you have CC/BCC arrays, list them here -->
              <!-- <li><a class="truncate">cc: {{ selectedEmail().cc?.join(', ') }}</a></li> -->
              <!-- <li><a class="truncate">bcc: {{ selectedEmail().bcc?.join(', ') }}</a></li> -->
            </ul>
          </div>
        </div>
      </div>

      <!-- Right-side quick actions -->
      <div class="flex items-center gap-1">
        <button class="btn btn-ghost btn-sm" aria-label="Print">üñ®Ô∏è</button>
        <button class="btn btn-ghost btn-sm" aria-label="Open in new">‚§¢</button>
      </div>
    </div>
  </header>

  <main class="flex-1 overflow-auto p-4 space-y-4">
    <p>{{ email.preview }}</p>

    <div>
      <h4 class="mb-2 font-semibold">Comments</h4>
      @for (comment of comments(); track comment.id) {
      <div class="mb-2 rounded bg-gray-100 p-2">{{ comment.comment }}</div>
      }
      <textarea [(ngModel)]="newComment" placeholder="Add a comment" class="w-full rounded border p-2"></textarea>
      <button (click)="addComment()" class="mt-2 rounded bg-blue-600 px-3 py-1 text-white">Add Comment</button>
    </div>

  </main>
  } @else {
  <div class="flex flex-1 flex-col items-center justify-center gap-3 text-gray-400 uppercase tracking-widest">
    <img class="max-w-64" src="assets/waiting.svg" />
    <span>No emails here!</span>
  </div>

  }
</section>
