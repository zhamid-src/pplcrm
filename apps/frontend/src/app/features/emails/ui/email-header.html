<header class="border-b border-gray-200 p-4">
  <div class="flex items-center gap-2 min-w-0 border-b-2 border-gray-100 pb-2">
    <h1 class="text-2xl font-semibold truncate">{{ email()!.subject }}</h1>
  </div>
  <div class="flex items-start gap-3 mt-2">
    <pc-email-assign [email]="email()"></pc-email-assign>
    <div class="min-w-0 flex-1"></div>

    <div class="flex items-center gap-1 text-sm text-base-content/70">
      <span class="whitespace-nowrap pr-2">
        {{ (getDateSent() || email()!.updated_at) | date:'EEE, MMM d, h:mm a' }}
      </span>

      <button class="btn btn-ghost btn-circle btn-sm" aria-label="Star" (click)="toggleFavourite()">
        <pc-icon [size]="4" [name]="getFavouriteIcon()" [class.text-primary]="isFavourite()"></pc-icon>
      </button>
      <button class="btn btn-ghost btn-circle btn-sm" aria-label="Reply">
        <pc-icon [size]="4" name="arrow-uturn-left"></pc-icon>
      </button>

      <div class="dropdown dropdown-end">
        <button class="btn btn-ghost btn-circle btn-sm" aria-label="More">
          <svg viewBox="0 0 24 24" class="h-5 w-5">
            <path
              fill="currentColor"
              d="M12 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"
            />
          </svg>
        </button>
        <ul class="menu dropdown-content bg-base-100 rounded-box z-[1] w-44 p-2 shadow">
          <li><a>Print</a></li>
          <li><a>Open in new</a></li>
          <li><a>Mark as unread</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="mt-3 flex items-center gap-3">
    <div class="avatar">
      <div class="w-10 rounded-full bg-base-200">
        <span class="flex h-full w-full items-center justify-center font-medium">
          {{ (email()!.from_name || email()!.from_email)![0] | uppercase }}
        </span>
      </div>
    </div>

    <div class="min-w-0 flex-1">
      <div class="flex items-baseline gap-2 min-w-0">
        <span class="font-semibold truncate"> {{ email()!.from_name || email()!.from_email }} </span>
        <span class="text-xs text-base-content/60 truncate"> &lt;{{ email()!.from_email }}&gt; </span>
      </div>

      <div class="text-xs text-base-content/60">
        to
        <div class="dropdown inline-block">
          <label tabindex="0" class="btn btn-link btn-sm font-light no-underline align-baseline">
            @if (getToRecipients().length > 0) { {{ getToRecipients()[0].name || getToRecipients()[0].email }} @if
            (getToRecipients().length > 1) {
            <span class="text-base-content/40">+{{ getToRecipients().length - 1 }} more</span>
            } } @else { {{ email()!.to_email }} }
            <svg class="ml-1 h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
              <path
                d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"
              />
            </svg>
          </label>
          <ul tabindex="0" class="menu menu-sm dropdown-content z-[1] mt-1 w-72 rounded-box bg-base-100 p-2 shadow">
            <li class="menu-title text-xs">Recipients</li>

            @if (getToRecipients().length > 0) {
            <li class="menu-title text-xs mt-2">To:</li>
            @for (recipient of getToRecipients(); track recipient.email) {
            <li><a class="truncate">{{ recipient.name || recipient.email }} &lt;{{ recipient.email }}&gt;</a></li>
            } } @if (getCcRecipients().length > 0) {
            <li class="menu-title text-xs mt-2">CC:</li>
            @for (recipient of getCcRecipients(); track recipient.email) {
            <li><a class="truncate">{{ recipient.name || recipient.email }} &lt;{{ recipient.email }}&gt;</a></li>
            } } @if (getBccRecipients().length > 0) {
            <li class="menu-title text-xs mt-2">BCC:</li>
            @for (recipient of getBccRecipients(); track recipient.email) {
            <li><a class="truncate">{{ recipient.name || recipient.email }} &lt;{{ recipient.email }}&gt;</a></li>
            } } @if (getToRecipients().length === 0 && getCcRecipients().length === 0 && getBccRecipients().length ===
            0) {
            <li><a class="truncate">{{ email()!.to_email }}</a></li>
            }
          </ul>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-1">
      <button class="btn btn-ghost btn-sm" aria-label="Open in new">
        <pc-icon name="arrows-pointing-out" [size]="4" class="text-gray-500"></pc-icon>
      </button>
    </div>
  </div>
</header>
